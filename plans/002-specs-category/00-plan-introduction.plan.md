# Specs Category  -  Build Plan

## Problem

As AI-assisted development becomes the norm, projects accumulate large volumes of specification markdown  -  plans, prompts, agent instructions, architecture docs, and similar files. These are fundamentally different from user-facing documentation (READMEs, API docs, tutorials) but currently get lumped into the "Docs" category. This inflates the docs count and skews the project summary, making it harder to see the true documentation footprint.

## What We're Building

A new **Specs** category that separates specification markdown from regular documentation. Markdown files (`.md`, `.mdx`) and reStructuredText files (`.rst`) inside specification directories are counted under "Specs" instead of "Docs." All other file types in spec directories retain their original category (Python stays Code, YAML stays Data, etc.).

## How Spec Directories Are Detected

A directory is a spec directory in one of four ways:

1. **Name is `specs`**  -  auto-detected at any depth in the tree
2. **Name is `specifications`**  -  auto-detected at any depth in the tree
3. **Name is `plans`**  -  auto-detected at any depth in the tree
4. **Name is `agents`**  -  auto-detected at any depth in the tree
5. **User-designated via S key** in the TUI  -  persisted in `.tally-config.toml`

Auto-detection by name (#1–3) is always active during counting, regardless of config state. The S key (#4) allows users to designate additional directories beyond the auto-detected ones. Both sources are merged at count time.

Files in subdirectories of a spec directory also count as specs (spec status cascades downward through the tree).

## Key Design Decisions

### Directory-Based Categorization (not file-based)

The current category system maps file extensions to categories via the `Language` dataclass. Specs break this model  -  a `.md` file can be either "docs" or "specs" depending on where it lives. Rather than changing the Language model, we:

1. Create spec-variant `Language` instances (identical to docs languages but with `category='specs'`) via an `as_spec()` function in `languages.py`.
2. Swap to the spec variant in the walker when a docs-category file is found inside a spec directory.
3. The aggregator and display handle the new category automatically since they're already data-driven.

### S Key Mirrors X Key Behavior

The S key works like X but for a different purpose:

| Key | State | Visual | Effect |
|-----|-------|--------|--------|
| X | Excluded | `[red]✗[/red] [dim]name[/dim]` | Directory and children skipped entirely |
| S | Spec | `[bright_cyan]S[/bright_cyan] name` | Docs files recategorized as specs |

Both cascade to children. They are mutually exclusive  -  pressing S on an excluded directory does nothing (un-exclude first with X). Pressing X on a spec directory excludes it (removes spec status).

Auto-detected spec directories (named `specs`, `specifications`, `plans`) are shown pre-marked in the TUI with a slightly different indicator: `[dim bright_cyan]S[/dim bright_cyan] [dim]name (auto)[/dim]` and cannot be toggled via S (similar to how gitignored directories can't be toggled via X).

### Config Persistence

The `.tally-config.toml` gains a new `[specs]` section:

```toml
# Generated by tallyman. Edit manually or re-run: tallyman --setup

[exclude]
directories = [
    "vendor",
]

[specs]
directories = [
    "docs/architecture",
    "project/requirements",
]
```

Only user-designated spec directories are saved. Auto-detected directories (by name) don't need config entries since they're always detected.

### Report Output

The Specs category appears in the totals between Docs and Data:

```
  Totals:
  Code:     11,413 lines (Python + Rust + JavaScript)
  Design:    2,100 lines (CSS + HTML)
  Docs:        500 lines (Markdown)
  Specs:     3,200 lines (Markdown)
  Data:        180 lines (TOML + JSON)
  Combined: 17,393 lines
```

In the per-language breakdown, when a language appears in both Docs and Specs, entries are distinguished with a category suffix:

```
──────────  Markdown (docs)  ──────────
       500 lines
       420 excluding blank lines
──────────  Markdown (specs)  ──────────
     3,200 lines
     2,800 excluding blank lines
```

When a language appears in only one category (the common case), no suffix is added.

The percentage bar includes spec files alongside other languages.

## Files Changed

| File | Changes |
|------|---------|
| [languages.py](../../src/tallyman/languages.py) | Add `as_spec()` function to create spec-variant Language instances |
| [config.py](../../src/tallyman/config.py) | Load/save spec dirs in `[specs]` section |
| [walker.py](../../src/tallyman/walker.py) | Accept `spec_dirs` param, auto-detect spec dir names, swap docs languages to spec variants |
| [aggregator.py](../../src/tallyman/aggregator.py) | Add `'specs'` to category order/names, group by Language object instead of name |
| [display.py](../../src/tallyman/display.py) | Handle duplicate language names with category suffix |
| [tui/setup_app.py](../../src/tallyman/tui/setup_app.py) | S key binding, spec node state, visual indicators, `user_spec_dirs` tracking |
| [cli.py](../../src/tallyman/cli.py) | Wire spec dirs through pipeline (load, pass to walker) |
| Tests | Update existing tests, add spec-specific tests |

## Phases

| Phase | Focus | Deliverable |
|-------|-------|-------------|
| [Phase 1](phase-01-language-config-walker.plan.md) | Language, Config & Walker | Spec variant languages, config persistence, directory detection during walking |
| [Phase 2](phase-02-tui-s-key.plan.md) | TUI S Key | Interactive spec directory designation in the setup TUI |
| [Phase 3](phase-03-aggregator-display-tests.plan.md) | Aggregator, Display & Tests | Category rendering, per-language disambiguation, test coverage |

Phase 1 is the backend foundation  -  after it's done, spec directories are detected and files are categorized correctly. Phase 2 adds the interactive configuration experience. Phase 3 makes the output look right and adds test coverage.
